"""Schema specification models and adapters."""

from __future__ import annotations

import importlib
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from schema_spec.dataset_handle import DatasetHandle
    from schema_spec.registration import DatasetRegistration, register_dataset
    from schema_spec.serialization import (
        dataset_spec_from_json,
        dataset_spec_from_msgpack,
        dataset_spec_payload,
        dataset_spec_to_json,
        dataset_spec_to_msgpack,
    )
    from schema_spec.specs import (
        DICT_STRING,
        ENCODING_DICTIONARY,
        ENCODING_META,
        KEY_FIELDS_META,
        PROVENANCE_COLS,
        PROVENANCE_SOURCE_FIELDS,
        REQUIRED_NON_NULL_META,
        SCHEMA_META_NAME,
        SCHEMA_META_VERSION,
        ArrowFieldSpec,
        DerivedFieldSpec,
        FieldBundle,
        NestedFieldSpec,
        TableSchemaSpec,
        call_span_bundle,
        dict_field,
        file_identity_bundle,
        list_view_type,
        provenance_bundle,
        schema_metadata,
        schema_metadata_for_spec,
        scip_range_bundle,
        span_bundle,
    )
    from schema_spec.system import (
        SCHEMA_EVOLUTION_PRESETS,
        ArrowValidationOptions,
        ContractCatalogSpec,
        ContractSpec,
        DatasetOpenSpec,
        DatasetSpec,
        DedupeSpecSpec,
        DeltaScanOptions,
        DeltaSchemaPolicy,
        DeltaWritePolicy,
        SortKeySpec,
        TableSchemaContract,
        TableSpecConstraints,
        ValidationPlans,
        VirtualFieldSpec,
        dataset_spec_from_contract,
        dataset_spec_from_dataset,
        dataset_spec_from_path,
        dataset_spec_from_schema,
        dataset_table_column_defaults,
        dataset_table_constraints,
        dataset_table_ddl_fingerprint,
        dataset_table_definition,
        dataset_table_logical_plan,
        ddl_fingerprint_from_definition,
        make_contract_spec,
        make_dataset_spec,
        make_table_spec,
        resolve_schema_evolution_spec,
        validate_arrow_table,
    )
    from schema_spec.view_specs import ViewSchemaMismatchError, ViewSpec

_EXPORT_MAP: dict[str, tuple[str, str]] = {
    "DICT_STRING": ("schema_spec.specs", "DICT_STRING"),
    "ENCODING_DICTIONARY": ("schema_spec.specs", "ENCODING_DICTIONARY"),
    "ENCODING_META": ("schema_spec.specs", "ENCODING_META"),
    "SCHEMA_EVOLUTION_PRESETS": ("schema_spec.system", "SCHEMA_EVOLUTION_PRESETS"),
    "KEY_FIELDS_META": ("schema_spec.specs", "KEY_FIELDS_META"),
    "PROVENANCE_COLS": ("schema_spec.specs", "PROVENANCE_COLS"),
    "PROVENANCE_SOURCE_FIELDS": ("schema_spec.specs", "PROVENANCE_SOURCE_FIELDS"),
    "REQUIRED_NON_NULL_META": ("schema_spec.specs", "REQUIRED_NON_NULL_META"),
    "SCHEMA_META_NAME": ("schema_spec.specs", "SCHEMA_META_NAME"),
    "SCHEMA_META_VERSION": ("schema_spec.specs", "SCHEMA_META_VERSION"),
    "ArrowFieldSpec": ("schema_spec.specs", "ArrowFieldSpec"),
    "ArrowValidationOptions": ("schema_spec.system", "ArrowValidationOptions"),
    "ContractCatalogSpec": ("schema_spec.system", "ContractCatalogSpec"),
    "ContractSpec": ("schema_spec.system", "ContractSpec"),
    "DatasetOpenSpec": ("schema_spec.system", "DatasetOpenSpec"),
    "DatasetHandle": ("schema_spec.dataset_handle", "DatasetHandle"),
    "DatasetRegistration": ("schema_spec.registration", "DatasetRegistration"),
    "DatasetSpec": ("schema_spec.system", "DatasetSpec"),
    "DedupeSpecSpec": ("schema_spec.system", "DedupeSpecSpec"),
    "DeltaScanOptions": ("schema_spec.system", "DeltaScanOptions"),
    "DeltaSchemaPolicy": ("schema_spec.system", "DeltaSchemaPolicy"),
    "DeltaWritePolicy": ("schema_spec.system", "DeltaWritePolicy"),
    "DerivedFieldSpec": ("schema_spec.specs", "DerivedFieldSpec"),
    "FieldBundle": ("schema_spec.specs", "FieldBundle"),
    "NestedFieldSpec": ("schema_spec.specs", "NestedFieldSpec"),
    "SortKeySpec": ("schema_spec.system", "SortKeySpec"),
    "TableSchemaSpec": ("schema_spec.specs", "TableSchemaSpec"),
    "TableSpecConstraints": ("schema_spec.system", "TableSpecConstraints"),
    "ValidationPlans": ("schema_spec.system", "ValidationPlans"),
    "VirtualFieldSpec": ("schema_spec.system", "VirtualFieldSpec"),
    "ViewSchemaMismatchError": ("schema_spec.view_specs", "ViewSchemaMismatchError"),
    "ViewSpec": ("schema_spec.view_specs", "ViewSpec"),
    "call_span_bundle": ("schema_spec.specs", "call_span_bundle"),
    "dataset_spec_from_contract": ("schema_spec.system", "dataset_spec_from_contract"),
    "dataset_spec_from_dataset": ("schema_spec.system", "dataset_spec_from_dataset"),
    "dataset_spec_from_path": ("schema_spec.system", "dataset_spec_from_path"),
    "dataset_spec_from_schema": ("schema_spec.system", "dataset_spec_from_schema"),
    "dataset_table_column_defaults": ("schema_spec.system", "dataset_table_column_defaults"),
    "dataset_table_constraints": ("schema_spec.system", "dataset_table_constraints"),
    "dataset_table_definition": ("schema_spec.system", "dataset_table_definition"),
    "dataset_table_ddl_fingerprint": ("schema_spec.system", "dataset_table_ddl_fingerprint"),
    "dataset_table_logical_plan": ("schema_spec.system", "dataset_table_logical_plan"),
    "ddl_fingerprint_from_definition": ("schema_spec.system", "ddl_fingerprint_from_definition"),
    "dict_field": ("schema_spec.specs", "dict_field"),
    "dataset_spec_from_json": ("schema_spec.serialization", "dataset_spec_from_json"),
    "dataset_spec_from_msgpack": ("schema_spec.serialization", "dataset_spec_from_msgpack"),
    "dataset_spec_payload": ("schema_spec.serialization", "dataset_spec_payload"),
    "dataset_spec_to_json": ("schema_spec.serialization", "dataset_spec_to_json"),
    "dataset_spec_to_msgpack": ("schema_spec.serialization", "dataset_spec_to_msgpack"),
    "file_identity_bundle": ("schema_spec.specs", "file_identity_bundle"),
    "list_view_type": ("schema_spec.specs", "list_view_type"),
    "make_contract_spec": ("schema_spec.system", "make_contract_spec"),
    "make_dataset_spec": ("schema_spec.system", "make_dataset_spec"),
    "make_table_spec": ("schema_spec.system", "make_table_spec"),
    "resolve_schema_evolution_spec": ("schema_spec.system", "resolve_schema_evolution_spec"),
    "provenance_bundle": ("schema_spec.specs", "provenance_bundle"),
    "schema_metadata": ("schema_spec.specs", "schema_metadata"),
    "schema_metadata_for_spec": ("schema_spec.specs", "schema_metadata_for_spec"),
    "register_dataset": ("schema_spec.registration", "register_dataset"),
    "scip_range_bundle": ("schema_spec.specs", "scip_range_bundle"),
    "span_bundle": ("schema_spec.specs", "span_bundle"),
    "TableSchemaContract": ("schema_spec.system", "TableSchemaContract"),
    "validate_arrow_table": ("schema_spec.system", "validate_arrow_table"),
}


def __getattr__(name: str) -> object:
    target = _EXPORT_MAP.get(name)
    if target is None:
        msg = f"module {__name__!r} has no attribute {name!r}"
        raise AttributeError(msg)
    module_path, attr_name = target
    module = importlib.import_module(module_path)
    return getattr(module, attr_name)


def __dir__() -> list[str]:
    return sorted(list(globals()) + list(_EXPORT_MAP))


__all__ = [
    "DICT_STRING",
    "ENCODING_DICTIONARY",
    "ENCODING_META",
    "KEY_FIELDS_META",
    "PROVENANCE_COLS",
    "PROVENANCE_SOURCE_FIELDS",
    "REQUIRED_NON_NULL_META",
    "SCHEMA_EVOLUTION_PRESETS",
    "SCHEMA_META_NAME",
    "SCHEMA_META_VERSION",
    "ArrowFieldSpec",
    "ArrowValidationOptions",
    "ContractCatalogSpec",
    "ContractSpec",
    "DatasetHandle",
    "DatasetOpenSpec",
    "DatasetRegistration",
    "DatasetSpec",
    "DedupeSpecSpec",
    "DeltaScanOptions",
    "DeltaSchemaPolicy",
    "DeltaWritePolicy",
    "DerivedFieldSpec",
    "FieldBundle",
    "NestedFieldSpec",
    "SortKeySpec",
    "TableSchemaContract",
    "TableSchemaSpec",
    "TableSpecConstraints",
    "ValidationPlans",
    "ViewSchemaMismatchError",
    "ViewSpec",
    "VirtualFieldSpec",
    "call_span_bundle",
    "dataset_spec_from_contract",
    "dataset_spec_from_dataset",
    "dataset_spec_from_json",
    "dataset_spec_from_msgpack",
    "dataset_spec_from_path",
    "dataset_spec_from_schema",
    "dataset_spec_payload",
    "dataset_spec_to_json",
    "dataset_spec_to_msgpack",
    "dataset_table_column_defaults",
    "dataset_table_constraints",
    "dataset_table_ddl_fingerprint",
    "dataset_table_definition",
    "dataset_table_logical_plan",
    "ddl_fingerprint_from_definition",
    "dict_field",
    "file_identity_bundle",
    "list_view_type",
    "make_contract_spec",
    "make_dataset_spec",
    "make_table_spec",
    "provenance_bundle",
    "register_dataset",
    "resolve_schema_evolution_spec",
    "schema_metadata",
    "schema_metadata_for_spec",
    "scip_range_bundle",
    "span_bundle",
    "validate_arrow_table",
]
